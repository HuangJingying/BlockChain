# 区块链的模拟实现

详情见 https://github.com/TeamFromNFLS/BlockChain

[TOC]

 

## 选题背景意义

### 选题原因

* 从宏观层面来说，区块链技术的地位和重要性不断提升，模拟实现区块链有助于理解前沿技术。在政策端，2019年1月10日，国家互联网信息办公室发布《区块链信息服务管理规定》；2019年10月24日，在中央政治局第十八次集体学习时，习近平总书记强调，“把区块链作为核心技术自主创新的重要突破口”和“加快推动区块链技术和产业创新发展”。在应用端，区块链在金融交易、物联网、公共服务、数字版权等领域应用广阔；特别是数字货币，已经产生大量的投资和商用案例。
* 从微观层面来说，区块链技术的实现与计算机程序设计密不可分，模拟实现区块链有助于提升C++的理论和实践水平。区块链技术实现的核心包括分布式存储、非对称加密、共识机制和智能合约等，它们依赖于哈希算法、加解密算法、共识算法等，涉及C++中类与对象、继承、链表等C++的重要内容。

### 理论意义

 

* 区块链的模拟实现涉及哈希算法、非对称加密等理论。对于哈希算法，它通过SHA256正向与反向计算的难度不对等，实现了挖矿原理，从而为记账者设计了奖励机制。对于非对称加密码，它从随机数、私钥到公钥、地址，结合哈希函数实现了电子签名，从而解决了身份认证的问题。
  + P2P网络协议
  + 共识机制
  + 哈希算法
  + 加密签名算法
  + 交易模型

### 实践意义

 

* 区块链的模拟实现交易记账、工作量证明（即“挖矿”）等功能。对于交易记账的功能，区块链的意义在于去中心化和低成本的优势。记账的信任来源从中心化的银行和大资本，转移到技术实现的分布式账本；同时，手续费和打包奖励也比中心化更为低廉。对于工作量证明的功能，区块链的意义在于为维护信用的人提供奖励机制，从而确保信用体系的运转。对于以上种种功能的意义，本质上来源于区块链自身的特殊性质——去中心化的共享数据库；因此，在模拟实现区块链的过程中不断对照和佐证理论与实践，也是我们的重要目标。

| **传统货币**                           | **数字货币**                                                 |
| -------------------------------------- | ------------------------------------------------------------ |
| **实名制：或多或少保留了交易者信息**   | 化名性                                                       |
| **中心化**                             | 点对点                                                       |
| **托管型安全性：安全性依赖于中心机构** | 自理型安全性：只要加密算法不被攻破，历史交易记录就不会丢失或被篡改；各节点用户也只需要保护好私钥 |
| **主权国家内部流通**                   | 广区域流通                                                   |

 

 

## 同类软件调研分析

 

* 同类软件以比特币为代表，同时还有以太坊，XRP等：
* 

![img](https://pics2.baidu.com/feed/34fae6cd7b899e513fe7629d52b5e136c9950de0.jpeg?token=abc1247fcf5fce6d91463885bceceb6b&s=80B27C3211DED5CE5E4D80CA0000E0B3)

* 比特币的特点是区块链特点的集中体现，包括去中心化、全世界流通、低交易费用等等。在理论层面，比特币的非对称加密算法是椭圆曲线ECDSA算法，采用了SHA256哈希函数，选择Proof of Work(POW)作为共识机制，交易模型为UTXO(Unspent Transaction Output)但是，比特币（这些不仅仅是比特币的问题）的不足也十分明显：交易确认时间长、价格波动极大、（it doesn’t matter）等等。
  + 无法对经济冷暖进行调控。当前各国央行的一大职责是通过调节货币发行量对经济进行宏观调控，但是数字货币的总量是恒定的 （?）

* 本次作业模拟实现的区块链相较于现实中的区块链在具体实现上有所不同，同时也根据个人能力和需求进行了简化。具体而言：
  + 比特币在加密算法上选择椭圆曲线，但本次项目选择1024位大质数RSA加密（目前已实现大数库封装，详情见 /Project/bigInteger）
  + 简化p2p网络，改用静态节点共同维护交易池的方式模拟节点广播等操作
  + 简化UTXO，目前仅打算实现单链UTXO（交易输入等于交易输出）

## 功能设计

### 加密算法

#### RSA

1. 大数类：参考见Demo/RSADemo
   1. 加速方案：大进制存储+汇编+基于牛顿迭代法的定义逆实现快速幂
2. MR法验证质数
   1. 加速方案：多线程
3. RSA实现

### 哈希算法

#### SHA256

- 这就不重复造轮子了

### p2p网络

#### 公共

1. 交易池：所有打包未打包的交易
   1. 交易记录：
      1. 交易ID
      2. 交易输入
      3. 交易输出
2. 添加新节点
   1. 同步区块链
   2. 验证区块链完整性（梅克尔树）

#### 节点

1. 普通节点（钱包）
   1. 私钥（随机生成）
   2. 公钥（RSA）
   3. 地址：私钥校验码+公钥哈希
2. 矿工节点（继承普通节点）
   1. 打包交易池中交易进区块链（工作量证明）
   2. 验证交易信息完整性
   3. 验证区块完整性

### 区块链

#### 区块头

| 字段             | 大小   | 描述                             |
| ---------------- | ------ | -------------------------------- |
| version          | 4字节  | 版本号，⽤于跟踪软件/协议的更新  |
| prevBlockHash    | 32字节 | 上一个区块的Hash地址             |
| merkleRoot       | 32字节 | 该区块中交易的merkle树根的哈希值 |
| time             | 4字节  | 该区块的创建时间戳               |
| difficultyTarget | 4字节  | 该区块链工作量证明难度目标       |
| nonce            | 4字节  | 用于证明工作量的计算参数         |

#### 区块体

| 字段                 | 大小      | 描述                   |
| -------------------- | --------- | ---------------------- |
| numTransactionsBytes | 1字节     | 交易数量占用的字节数   |
| numTransactions      | 0-8个字节 | 区块内存储的交易数量   |
| transactions         | 不确定    | 区块内存的多个交易数据 |